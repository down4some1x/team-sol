<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>Team Sol Explorers x NASA Prototype</title>

    <!-- Bootstrap core CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl"
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
      crossorigin=""
    />
    <link rel="stylesheet" href="css/popupMod.css" />
    <link rel="stylesheet" href="css/draw-on-map.css" />
    <link rel="stylesheet" href="css/L.Control.MousePosition.css" />

    <script src="https://unpkg.com/phosphor-icons"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <!-- Make sure you put this AFTER Leaflet's CSS -->

    <!-- Custom styles for this template -->
    <link href="css/main.css" rel="stylesheet" />
  </head>

  <body>
    <div class="Nav">
      <nav class="navbar navbar-dark" style="background-color: #262626">
        <div class="container-fluid p-2">
          <!-- <a class="navbar-brand" href="#"><i class="ph-house mx-2"></i></a> -->
          <p class="my-0 mx-4">SOL 125</p>
          <p class="my-0"><span id="date-time"></span></p>
          <p class="my-0 mx-4">EVA #3231</p>
        </div>
      </nav>
    </div>

    <div class="container-fluid row mx-0 px-0">
      <div class="col-9 mapContainer px-0">
        <div id="mapid"></div>
      </div>
      <div class="col-3 px-0 sidebarContent">
        <div class="nestedTabs">
          <nav>
            <div
              class="nav narbar-dark bg-dark nav-tabs"
              id="nav-tab"
              role="tablist"
            >
              <button
                class="nav-link active"
                id="nav-home-tab"
                data-bs-toggle="tab"
                data-bs-target="#nav-home"
                type="button"
                role="tab"
                aria-controls="nav-home"
                aria-selected="true"
              >
                <span class="nestedTabTextStyle">
                  <i class="ph-book-open mx-2"></i>
                  Procedure
                </span>
              </button>
              <button
                class="nav-link"
                id="nav-profile-tab"
                data-bs-toggle="tab"
                data-bs-target="#nav-profile"
                type="button"
                role="tab"
                aria-controls="nav-profile"
                aria-selected="false"
              >
                <span class="nestedTabTextStyle">
                  <i class="ph-wrench mx-2"></i>
                  Tools
                </span>
              </button>
              <button
                class="nav-link"
                id="nav-contact-tab"
                data-bs-toggle="tab"
                data-bs-target="#nav-contact"
                type="button"
                role="tab"
                aria-controls="nav-contact"
                aria-selected="false"
              >
                <span class="nestedTabTextStyle">
                  <i class="ph-map-pin-line mx-2"></i> Zones
                </span>
              </button>
            </div>
          </nav>
          <div class="tab-content" id="nav-tabContent">
            <div
              class="tab-pane fade show active"
              id="nav-home"
              role="tabpanel"
              aria-labelledby="nav-home-tab"
            >
              <div class="accordion accordion-flush" id="accordionFlushExample">
                <div class="accordion-item">
                  <h2 class="accordion-header" id="flush-headingOne">
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#flush-collapseOne"
                      aria-expanded="false"
                      aria-controls="flush-collapseOne"
                    >
                      <div class="accordionLabel">
                        <div>
                          <h5>Task 1</h5>
                          <p
                            style="text-transform: uppercase; color: gray"
                            class="my-0"
                          >
                            Zone A (Sites 1-3)
                          </p>
                        </div>
                        <span class="nestedTabTextStyle mx-2">
                          <i class="ph-timer mx-2"></i> 30 min
                        </span>
                      </div>
                    </button>
                  </h2>
                  <div
                    id="flush-collapseOne"
                    class="accordion-collapse collapse"
                    aria-labelledby="flush-headingOne"
                    data-bs-parent="#accordionFlushExample"
                  >
                    <div class="accordion-body">
                      <div class="form-check">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          value=""
                          id="flexCheckDefault"
                        />
                        <label class="form-check-label" for="flexCheckDefault">
                          Default checkbox
                        </label>
                      </div>
                      <div class="form-check">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          value=""
                          id="flexCheckChecked"
                        />
                        <label class="form-check-label" for="flexCheckChecked">
                          Checked checkbox
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="flush-headingTwo">
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#flush-collapseTwo"
                      aria-expanded="false"
                      aria-controls="flush-collapseTwo"
                    >
                      <div class="accordionLabel">
                        <div>
                          <h5>Task 2</h5>
                          <p
                            style="text-transform: uppercase; color: gray"
                            class="my-0"
                          >
                            Zone B (Sites 3-6)
                          </p>
                        </div>
                        <span class="nestedTabTextStyle mx-2">
                          <i class="ph-timer mx-2"></i> 90 min
                        </span>
                      </div>
                    </button>
                  </h2>
                  <div
                    id="flush-collapseTwo"
                    class="accordion-collapse collapse"
                    aria-labelledby="flush-headingTwo"
                    data-bs-parent="#accordionFlushExample"
                  >
                    <div class="accordion-body">
                      Placeholder content for this accordion, which is intended
                      to demonstrate the <code>.accordion-flush</code> class.
                      This is the second item's accordion body. Let's imagine
                      this being filled with some actual content.
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="flush-headingThree">
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#flush-collapseThree"
                      aria-expanded="false"
                      aria-controls="flush-collapseThree"
                    >
                      <div class="accordionLabel">
                        <div>
                          <h5>Task 3</h5>
                          <p
                            style="text-transform: uppercase; color: gray"
                            class="my-0"
                          >
                            Zone C (Sites 6-9)
                          </p>
                        </div>
                        <span class="nestedTabTextStyle mx-2">
                          <i class="ph-timer mx-2"></i> 60 min
                        </span>
                      </div>
                    </button>
                  </h2>
                  <div
                    id="flush-collapseThree"
                    class="accordion-collapse collapse"
                    aria-labelledby="flush-headingThree"
                    data-bs-parent="#accordionFlushExample"
                  >
                    <div class="accordion-body">
                      Placeholder content for this accordion, which is intended
                      to demonstrate the <code>.accordion-flush</code> class.
                      This is the third item's accordion body. Nothing more
                      exciting happening here in terms of content, but just
                      filling up the space to make it look, at least at first
                      glance, a bit more representative of how this would look
                      in a real-world application.
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="tab-pane fade"
              id="nav-profile"
              role="tabpanel"
              aria-labelledby="nav-profile-tab"
            >
              Tools Content
            </div>
            <div
              class="tab-pane fade"
              id="nav-contact"
              role="tabpanel"
              aria-labelledby="nav-contact-tab"
            >
              Zone Info
            </div>
          </div>
        </div>
        <div class="consumables">
          <div class="consumableCard">
            <h5 id="oxygenTimer">01:34:23</h5>
            <p>Time Remaining</p>
          </div>
          <div class="consumableCard">
            <h5>01:12:54</h5>
            <p>Elapsed Time</p>
          </div>
          <div class="consumableCard">
            <h5>00:44:32</h5>
            <p>Oxygen</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
      integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
      crossorigin=""
    ></script>
    <script src="js/popupMod.js" type="text/javascript"></script>
    <script src="js/draw-on-map.min.js"></script>
    <script src="js/L.Control.MousePosition.js"></script>
    <script src="js/map_data.js"></script>

    <!-- Menu Toggle Script -->
    <script>
      // Running Oxygen Consumable Timer
      var countDownDate = new Date().getTime() + 3 * 60 * 60 * 1000;
      var timeClear = setInterval(function () {
        var now = new Date().getTime();
        var timeLeft = countDownDate - now;
        var hours = Math.floor(
          (timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
        );
        var minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
        document.querySelector("#oxygenTimer").innerHTML =
          hours + ":" + minutes + ":" + seconds;
        if (timeLeft < 0) {
          clearInterval(timeClear);
          document.querySelector(".oxygenTimer").innerHTML = "00:00:00";
        }
      }, 1000);

      const dateDiv = document.getElementById("date-time");

      function myDateFunction() {
        const now = new Date();
        const nowStr = now.toUTCString();
        dateDiv.innerHTML = nowStr;
      }

      setInterval(myDateFunction, 1000);

      var evLocation = [-12.802112, -141.679669];
      var mymap = L.map("mapid").setView(evLocation, 5);

      L.control.mousePosition({lngFirst: true}).addTo(mymap);

      // add leaflet-geoman controls with some options to the map
      mymap.pm.addControls({
        position: "topleft",
      });

      var marsLabeledMapLayer = L.tileLayer(
        // "https://mars.nasa.gov/mmgis-maps/M20/Layers/Jezero_Balanced_Visible_HiRISE_HRSCcolor_IHS_pansharp/{z}/{x}/{y}.png",
        "https://cartocdn-gusc.global.ssl.fastly.net/opmbuilder/api/v1/map/named/opm-mars-basemap-v0-2/all/{z}/{x}/{y}.png",
        {
          attribution:
            'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
          zoom: 3,
          tms: false,
        }
      )
        .addTo(mymap)
        .setZIndex(0);

      var marsShaded = L.tileLayer(
        "http://s3-eu-west-1.amazonaws.com/whereonmars.cartodb.net/celestia_mars-shaded-16k_global/{z}/{x}/{y}.png",
        {
          zoom: 3,
          tms: true,
        }
      );

      var marsMOLA = L.tileLayer(
        "http://s3-eu-west-1.amazonaws.com/whereonmars.cartodb.net/mola-color/{z}/{x}/{y}.png",
        {
          zoom: 3,
          tms: true,
        }
      );

      var marsVikingLayer = L.tileLayer(
        "http://s3-eu-west-1.amazonaws.com/whereonmars.cartodb.net/viking_mdim21_global/{z}/{x}/{y}.png",
        {
          zoom: 3,
          tms: true,
        }
      );

      var marsGrayscale = L.tileLayer(
        "http://s3-eu-west-1.amazonaws.com/whereonmars.cartodb.net/mola-gray/{z}/{x}/{y}.png",
        {
          zoom: 3,
          tms: true,
        }
      );

      var marsHillshade = L.tileLayer(
        "https://s3.us-east-2.amazonaws.com/opmmarstiles/hillshade-tiles/{z}/{x}/{y}.png",
        {
          zoom: 3,
          tms: true,
        }
      );

      var yellowCircleMarker = L.icon({
        iconUrl: "./assets/icons/YellowCircle.svg",
        iconSize: [32, 32],
        iconAnchor: [16, 16],
        popupAnchor: [0, -10],
      });

      var yellowSquareMarker = L.icon({
        iconUrl: "./assets/icons/YellowSquare.svg",
        iconSize: [32, 32],
        iconAnchor: [16, 16],
        popupAnchor: [0, -10],
      });

      function onEachFeature(feature, layer) {
        var popupContent ="<p>[" +
          feature.geometry.coordinates +
          "]:</p>";

        if (feature.properties && feature.properties.popupContent) {
          popupContent += feature.properties.popupContent;
        }

        layer.bindPopup(popupContent, { removable: true, editable: true });
      }

      var goZoneStyle = {
        // fillColor: 'rgba(49, 177, 77, 1)',
        color: "rgba(49, 177, 77, 1)",
        weight: 5,
      };

      var goZoneLayer = L.geoJSON(
        { features: [GoZones] },
        {
          style: goZoneStyle,
        }
      ).addTo(mymap);

      var noGoLayer = L.geoJSON(
        { features: [NoGoZones] },
        {
          // style: NoGoZoneStyle,
          pointToLayer: function (feature, latlng) {
            return L.circleMarker(latlng, {
              radius: feature.properties.radius,
              fillColor: "rgba(231, 24, 24, 0.8)",
              color: "rgba(231, 24, 24, 1)",
              weight: 1,
            });
          },
        }
      ).addTo(mymap);

      var markerLayer = L.geoJSON(
        { features: [markerLabels] },
        {
          onEachFeature: onEachFeature,
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {
              icon:
                feature.properties.type === "ev"
                  ? yellowCircleMarker
                  : yellowSquareMarker,
            });
          },
        }
      ).addTo(mymap);
      // controlLayers.addOverlay(markerLayer, "Markers");

      var plannedWaypointLineStyle = {
        color: "#A7A7A7",
        // dashArray: 4,
        weight: 6,
      };

      var plannedWaypoints = L.geoJSON(
        { features: [plannedWaypoints] },
        {
          style: plannedWaypointLineStyle,
        }
      ).addTo(mymap);

      var actualWaypointLineStyle = {
        color: "white",
        dashArray: 4,
        weight: 2,
      };

      var actualWaypoints = L.geoJSON(
        { features: [actualWaypoints] },
        {
          style: actualWaypointLineStyle,
        }
      ).addTo(mymap);

      function onMapClick(e) {
        console.log("You clicked the map at " + e.latlng.toString());
      }

      mymap.on("click", onMapClick);

      L.control
        .scale({
          metric: true,
          imperial: true,
          position: "topright",
        })
        .addTo(mymap);

      var baseMaps = {
        "Label Map": marsLabeledMapLayer,
        "Shaded Map": marsShaded,
        "Color Coded MOLA Elevation Map": marsMOLA,
        "Viking Map": marsVikingLayer,
        "Greyscale Map": marsGrayscale,
        "Hillshade Map": marsHillshade,
      };

      var overlayMaps = {
        "Go Zones": goZoneLayer,
        "No Go Zones": noGoLayer,
        Markers: markerLayer,
        "Actual Waypoints": actualWaypoints,
        "Planned Waypoints": plannedWaypoints,
      };

      L.control.layers(baseMaps, overlayMaps).addTo(mymap);
    </script>
  </body>
</html>
