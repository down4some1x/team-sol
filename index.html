<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>Team Sol Explorers x NASA Prototype</title>

    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="./apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="./favicon-16x16.png"
    />
    <link rel="manifest" href="./site.webmanifest" />
    <meta name="msapplication-TileColor" content="#2b5797" />
    <meta name="theme-color" content="#262626" />

    <!-- Bootstrap core CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    />

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
      crossorigin=""
    />
    <link rel="stylesheet" href="css/MarkerCluster.css" />
    <link rel="stylesheet" href="css/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="css/popupMod.css" />
    <link rel="stylesheet" href="css/draw-on-map.css" />
    <link rel="stylesheet" href="css/L.Control.MousePosition.css" />
    <link rel="stylesheet" href="css/leaflet.contextmenu.min.css" />
    <link rel="stylesheet" href="css/L.Icon.Pulse.css" />
    <link rel="stylesheet" href="css/L.Icon.FontAwesome.css" />

    <script src="https://unpkg.com/phosphor-icons"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <!-- Make sure you put this AFTER Leaflet's CSS -->

    <!-- Custom styles for this template -->
    <link href="css/main.css" rel="stylesheet" />
  </head>

  <body>
    <div class="Nav">
      <nav class="navbar navbar-dark" style="background-color: #262626">
        <div class="container-fluid p-2">
          <div
            class="navbar-brand"
            style="display: flex; flex-direction: row; align-items: center"
          >
            <img
              class="mx-2"
              src="assets/icons/team-sol-logo.svg"
              height="18"
              width="18"
            />
            <p class="my-0 mx-1">SOL 125</p>
          </div>
          <p class="my-0"><span id="date-time"></span></p>
          <p class="my-0 mx-4">EVA #3231</p>
        </div>
      </nav>
    </div>

    <div class="container-fluid row mx-0 px-0">
      <div class="col-9 mapContainer px-0">
        <div id="mapid"></div>
      </div>
      <div class="col-3 px-0 sidebarContent">
        <div class="nestedTabs">
          <nav>
            <div
              class="nav narbar-dark bg-dark nav-tabs"
              id="nav-tab"
              role="tablist"
            >
              <button
                class="nav-link active"
                id="nav-home-tab"
                data-bs-toggle="tab"
                data-bs-target="#nav-home"
                type="button"
                role="tab"
                aria-controls="nav-home"
                aria-selected="true"
              >
                <span class="nestedTabTextStyle">
                  <i class="ph-book-open mx-2"></i>
                  Procedure
                </span>
              </button>
              <button
                class="nav-link"
                id="nav-profile-tab"
                data-bs-toggle="tab"
                data-bs-target="#nav-profile"
                type="button"
                role="tab"
                aria-controls="nav-profile"
                aria-selected="false"
              >
                <span class="nestedTabTextStyle">
                  <i class="ph-wrench mx-2"></i>
                  Tools
                </span>
              </button>
              <button
                class="nav-link"
                id="nav-contact-tab"
                data-bs-toggle="tab"
                data-bs-target="#nav-contact"
                type="button"
                role="tab"
                aria-controls="nav-contact"
                aria-selected="false"
              >
                <span class="nestedTabTextStyle">
                  <i class="ph-map-pin-line mx-2"></i> Zones
                </span>
              </button>
            </div>
          </nav>
          <div class="tab-content" id="nav-tabContent">
            <div
              class="tab-pane fade show active"
              id="nav-home"
              role="tabpanel"
              aria-labelledby="nav-home-tab"
            >
              <div class="accordion accordion-flush" id="accordionFlushExample">
                <div class="accordion-item">
                  <h2 class="accordion-header" id="flush-headingOne">
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#flush-collapseOne"
                      aria-expanded="false"
                      aria-controls="flush-collapseOne"
                    >
                      <div class="accordionLabel">
                        <div>
                          <h5>Task 1</h5>
                          <p
                            style="text-transform: uppercase; color: gray"
                            class="my-0"
                          >
                            Zone A (Sites 1-3)
                          </p>
                        </div>
                        <span class="nestedTabTextStyle mx-2">
                          <i class="ph-timer mx-2"></i> 30 min
                        </span>
                      </div>
                    </button>
                  </h2>
                  <div
                    id="flush-collapseOne"
                    class="accordion-collapse collapse"
                    aria-labelledby="flush-headingOne"
                    data-bs-parent="#accordionFlushExample"
                  >
                    <div
                      class="accordion-body"
                      id="sortable"
                      data-sortable-id="0"
                      aria-dropeffect="move"
                    >
                      <ul class="procedure-step-list">
                        <li
                          class="my-2"
                          data-id="1"
                          data-item-sortable-id="1"
                          draggable="true"
                          role="option"
                          aria-grabbed="false"
                        >
                          <input type="checkbox" />
                          <span
                            class="editableStep"
                            style="border-bottom: 1px dashed lightgray"
                          >
                            1.1. Confirm site location upon arrival.
                          </span>
                        </li>
                        <li
                          class="my-2"
                          data-id="2"
                          data-item-sortable-id="2"
                          draggable="true"
                          role="option"
                          aria-grabbed="false"
                        >
                          <input type="checkbox" />
                          <span
                            class="editableStep"
                            style="border-bottom: 1px dashed lightgray"
                          >
                            1.2. Collect soil auger, 3 sample bags, soil probe,
                            soil core sampler, and 3 sampler syringes from the
                            tool kit.
                          </span>
                        </li>
                        <li
                          class="my-2"
                          data-id="3"
                          data-item-sortable-id="3"
                          draggable="true"
                          role="option"
                          aria-grabbed="false"
                        >
                          <input type="checkbox" />
                          <span
                            class="editableStep"
                            style="border-bottom: 1px dashed lightgray"
                          >
                            1.3. Sample Site 1
                          </span>
                          <ul class="sub-task-list">
                            <li class="my-2">
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.3.1. Travel to sample site 1.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.3.2. Use the soil auger to collect surface
                                soil and transfer into the sample bag.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.3.3. Stow sample bag.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.3.4. Use the soil probe to remove 6 inches of
                                soil.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.3.5. Load a sampler syringe into the soil core
                                sampler.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.3.6. Use the soil core sampler to collect the
                                sample from the probed hole.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.3.7. Remove syringe from sampler and stow.
                              </span>
                            </li>
                          </ul>
                        </li>
                        <li
                          class="my-2"
                          data-id="3"
                          data-item-sortable-id="3"
                          draggable="true"
                          role="option"
                          aria-grabbed="false"
                        >
                          <input type="checkbox" />
                          <span
                            class="editableStep"
                            style="border-bottom: 1px dashed lightgray"
                          >
                            1.4. Sample Site 2
                          </span>
                          <ul class="sub-task-list">
                            <li class="my-2">
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.4.1. Travel to sample site 2.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.4.2. Use the soil auger to collect surface
                                soil and transfer into the sample bag.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.4.3. Stow sample bag.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.4.4. Use the soil probe to remove 12 inches of
                                soil.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.4.5. Load a sampler syringe into the soil core
                                sampler.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.4.6. Use the soil core sampler to collect the
                                sample from the probed hole.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.4.7. Remove syringe from sampler and stow.
                              </span>
                            </li>
                          </ul>
                        </li>
                        <li
                          class="my-2"
                          data-id="4"
                          data-item-sortable-id="4"
                          draggable="true"
                          role="option"
                          aria-grabbed="false"
                        >
                          <input type="checkbox" />
                          <span
                            class="editableStep"
                            style="border-bottom: 1px dashed lightgray"
                          >
                            1.5. Sample Site 3
                          </span>
                          <ul class="sub-task-list">
                            <li class="my-2">
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.5.1. Travel to sample site 3.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.5.2. Use the soil auger to collect surface
                                soil and transfer into the sample bag.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.5.3. Collect 3 basalt rocks approximately 2
                                inches in diameter and transfer into the sample
                                bag.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.5.4. Stow sample bag.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.5.5. Use the soil probe to remove 24 inches of
                                soil.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.5.6. Load a sampler syringe into the soil core
                                sampler.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.5.7. Use the soil core sampler to collect the
                                sample from the probed hole.
                              </span>
                            </li>
                            <li>
                              <input type="checkbox" />
                              <span class="editableStep">
                                1.5.8. Remove syringe from sampler and stow.
                              </span>
                            </li>
                          </ul>
                        </li>
                        <li
                          class="my-2"
                          data-id="5"
                          data-item-sortable-id="5"
                          draggable="true"
                          role="option"
                          aria-grabbed="false"
                        >
                          <input type="checkbox" />
                          <span
                            class="editableStep"
                            style="border-bottom: 1px dashed lightgray"
                          >
                            1.6. Return soil auger, soil probe, and soil core
                            sampler to the tool kit.
                          </span>
                        </li>
                        <li
                          class="my-2"
                          data-id="6"
                          data-item-sortable-id="6"
                          draggable="true"
                          role="option"
                          aria-grabbed="false"
                        >
                          <input type="checkbox" />
                          <span
                            class="editableStep"
                            style="border-bottom: 1px dashed lightgray"
                          >
                            1.7. Place 3 sample bags and 3 sampler syringes into
                            the collection box.
                          </span>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="flush-headingTwo">
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#flush-collapseTwo"
                      aria-expanded="false"
                      aria-controls="flush-collapseTwo"
                    >
                      <div class="accordionLabel">
                        <div>
                          <h5>Task 2</h5>
                          <p
                            style="text-transform: uppercase; color: gray"
                            class="my-0"
                          >
                            Zone B (Sites 3-6)
                          </p>
                        </div>
                        <span class="nestedTabTextStyle mx-2">
                          <i class="ph-timer mx-2"></i> 90 min
                        </span>
                      </div>
                    </button>
                  </h2>
                  <div
                    id="flush-collapseTwo"
                    class="accordion-collapse collapse"
                    aria-labelledby="flush-headingTwo"
                    data-bs-parent="#accordionFlushExample"
                  >
                    <div class="accordion-body">
                      Placeholder content for this accordion, which is intended
                      to demonstrate the <code>.accordion-flush</code> class.
                      This is the second item's accordion body. Let's imagine
                      this being filled with some actual content.
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="flush-headingThree">
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#flush-collapseThree"
                      aria-expanded="false"
                      aria-controls="flush-collapseThree"
                    >
                      <div class="accordionLabel">
                        <div>
                          <h5>Task 3</h5>
                          <p
                            style="text-transform: uppercase; color: gray"
                            class="my-0"
                          >
                            Zone C (Sites 6-9)
                          </p>
                        </div>
                        <span class="nestedTabTextStyle mx-2">
                          <i class="ph-timer mx-2"></i> 60 min
                        </span>
                      </div>
                    </button>
                  </h2>
                  <div
                    id="flush-collapseThree"
                    class="accordion-collapse collapse"
                    aria-labelledby="flush-headingThree"
                    data-bs-parent="#accordionFlushExample"
                  >
                    <div class="accordion-body">
                      Placeholder content for this accordion, which is intended
                      to demonstrate the <code>.accordion-flush</code> class.
                      This is the third item's accordion body. Nothing more
                      exciting happening here in terms of content, but just
                      filling up the space to make it look, at least at first
                      glance, a bit more representative of how this would look
                      in a real-world application.
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="tab-pane fade"
              id="nav-profile"
              role="tabpanel"
              aria-labelledby="nav-profile-tab"
            >
              Tools Content
            </div>
            <div
              class="tab-pane fade"
              id="nav-contact"
              role="tabpanel"
              aria-labelledby="nav-contact-tab"
            >
              Zone Info
            </div>
          </div>
        </div>
        <div class="consumables">
          <div class="consumableCard">
            <h5 id="oxygenTimer">01:34:23</h5>
            <p>Time Remaining</p>
          </div>
          <div class="consumableCard">
            <h5>01:12:54</h5>
            <p>Elapsed Time</p>
          </div>
          <div class="consumableCard">
            <h5>00:44:32</h5>
            <p>Oxygen</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap core JavaScript -->
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
      integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
      crossorigin=""
    ></script>
    <script src="https://unpkg.com/leaflet.marker.slideto@0.2.0/Leaflet.Marker.SlideTo.js"></script>
    <script src="js/leaflet.markercluster.js"></script>
    <script src="js/leaflet.markercluster.js.map"></script>
    <script src="js/popupMod.js" type="text/javascript"></script>
    <script src="js/draw-on-map.min.js"></script>
    <script src="js/L.Control.MousePosition.js"></script>
    <script src="js/leaflet.contextmenu.min.js"></script>
    <script src="js/L.Icon.Pulse.js"></script>
    <script
      src="https://kit.fontawesome.com/b41bf0afa7.js"
      crossorigin="anonymous"
    ></script>
    <script src="js/L.Icon.FontAwesome.js"></script>
    <script src="js/domEdit.js"></script>
    <script src="js/map_data.js"></script>

    <!-- Menu Toggle Script -->
    <script>
      // Running Oxygen Consumable Timer
      var countDownDate = new Date().getTime() + 3 * 60 * 60 * 1000;
      var timeClear = setInterval(function () {
        var now = new Date().getTime();
        var timeLeft = countDownDate - now;
        var hours = Math.floor(
          (timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
        );
        var minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
        document.querySelector("#oxygenTimer").innerHTML =
          hours + ":" + minutes + ":" + seconds;
        if (timeLeft < 0) {
          clearInterval(timeClear);
          document.querySelector(".oxygenTimer").innerHTML = "00:00:00";
        }
      }, 1000);

      const dateDiv = document.getElementById("date-time");

      function myDateFunction() {
        const now = new Date();
        const nowStr = now.toUTCString();
        dateDiv.innerHTML = nowStr;
      }

      setInterval(myDateFunction, 1000);
      // Editable Steps

      $(".editableStep").domEdit({
        editorClass: "editableStep",
        onSetEditorStyle: function ($editor, $editingElement) {
          $editor.css("color", "#fff");
          $editor.css("background-color", "#525252");
          $editor.css("border-style", "dotted");
          $editor.css("border-bottom-width", "1px");
          $editor.css("border-color", "#B1B1B1");
          $editor.css("width", "300px");
          $editor.css("height", "50px");
          $editor.css("outline", "none");
        },
      });

      // Drag and Drop Steps
      // $(function () {
      //   $("#sortable").sortable();
      //   $("#sortable").disableSelection();
      // });

      // Map JS

      var mymap,
        evLocation = [-12.802112, -141.679669];
      // var mymap = L.map("mapid").setView(evLocation, 5);

      var yellowCircleMarker = L.icon({
        iconUrl: "./assets/icons/YellowCircle.svg",
        iconSize: [32, 32],
        iconAnchor: [16, 16],
        popupAnchor: [0, -10],
      });

      var yellowSquareMarker = L.icon({
        iconUrl: "./assets/icons/YellowSquare.svg",
        iconSize: [32, 32],
        iconAnchor: [16, 16],
        popupAnchor: [0, -10],
      });

      function centerMap(e) {
        mymap.panTo(e.latlng);
      }

      function zoomIn(e) {
        mymap.zoomIn();
      }

      function zoomOut(e) {
        mymap.zoomOut();
      }

      function tagLocation(e) {
        var taggedLocation = L.marker(e.latlng, {
          icon: L.icon.fontAwesome({
            iconClasses: "fas fa-sticky-note",
            // marker/background style
            markerColor: "#EFA029",
            markerFillOpacity: 1,
            // icon style
            iconColor: "#FFF",
            iconXOffset: 0,
            iconYOffset: 0,
          }),
        }).addTo(mymap);
        taggedLocation
          .bindPopup(
            "<p>[" +
              e.latlng.lng.toPrecision(7) +
              ", " +
              e.latlng.lat.toPrecision(7) +
              "]: </p>",
            { removable: true, editable: true }
          )
          .openPopup();
      }

      function tagPhoto(e) {
        var taggedPhoto = L.marker(e.latlng, {
          icon: L.icon.fontAwesome({
            iconClasses: "fas fa-image",
            // marker/background style
            markerColor: "#00a9ce",
            markerFillOpacity: 1,
            // icon style
            iconColor: "#FFF",
            iconXOffset: -2,
            iconYOffset: 0,
          }),
        }).addTo(mymap);
        taggedPhoto
          .bindPopup(
            "<p>[" +
              e.latlng.lng.toPrecision(7) +
              ", " +
              e.latlng.lat.toPrecision(7) +
              "]: </p>",
            { removable: true }
          )
          .openPopup();
      }

      mymap = L.map("mapid", {
        minZoom: 3,
        maxZoom: 8,
        contextmenu: true,
        contextmenuWidth: 140,
        contextmenuItems: [
          {
            text: "Move EV Marker",
            icon: "assets/icons/navigation-arrow.png",
            callback: handleEVMarkerMove,
          },
          {
            text: "Tag Location",
            icon: "assets/icons/note.png",
            callback: tagLocation,
          },
          {
            text: "Tag Photo",
            icon: "assets/icons/photo.png",
            callback: tagPhoto,
          },
        ],
      }).setView(evLocation, 5);

      L.control.mousePosition({ lngFirst: true }).addTo(mymap);

      var pulsingIcon = L.icon.pulse({
        iconSize: [20, 20],
        color: "#F8E71C",
        fillColor: "#F8E71C",
      });
      var markerPulse = L.marker([-7.258252, -132.954745], {
        icon: pulsingIcon,
      }).addTo(mymap);

      // add leaflet-geoman controls with some options to the map
      mymap.pm.addControls({
        position: "topleft",
      });

      var marsLabeledMapLayer = L.tileLayer(
        // "https://mars.nasa.gov/mmgis-maps/M20/Layers/Jezero_Balanced_Visible_HiRISE_HRSCcolor_IHS_pansharp/{z}/{x}/{y}.png",
        "https://cartocdn-gusc.global.ssl.fastly.net/opmbuilder/api/v1/map/named/opm-mars-basemap-v0-2/all/{z}/{x}/{y}.png",
        {
          attribution:
            'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
          zoom: 3,
          tms: false,
        }
      )
        .addTo(mymap)
        .setZIndex(0);

      var marsShaded = L.tileLayer(
        "http://s3-eu-west-1.amazonaws.com/whereonmars.cartodb.net/celestia_mars-shaded-16k_global/{z}/{x}/{y}.png",
        {
          zoom: 3,
          tms: true,
        }
      );

      var marsMOLA = L.tileLayer(
        "http://s3-eu-west-1.amazonaws.com/whereonmars.cartodb.net/mola-color/{z}/{x}/{y}.png",
        {
          zoom: 3,
          tms: true,
        }
      );

      var marsVikingLayer = L.tileLayer(
        "http://s3-eu-west-1.amazonaws.com/whereonmars.cartodb.net/viking_mdim21_global/{z}/{x}/{y}.png",
        {
          zoom: 3,
          tms: true,
        }
      );

      var marsGrayscale = L.tileLayer(
        "http://s3-eu-west-1.amazonaws.com/whereonmars.cartodb.net/mola-gray/{z}/{x}/{y}.png",
        {
          zoom: 3,
          tms: true,
        }
      );

      var marsHillshade = L.tileLayer(
        "https://s3.us-east-2.amazonaws.com/opmmarstiles/hillshade-tiles/{z}/{x}/{y}.png",
        {
          zoom: 3,
          tms: true,
        }
      );

      function onEachFeature(feature, layer) {
        // console.log({ feature, layer });
        var popupContent = "<p>[" + feature.geometry.coordinates + "]:</p>";

        if (feature.properties && feature.properties.popupContent) {
          popupContent += feature.properties.popupContent;
        }

        layer.bindPopup(popupContent, { removable: true, editable: true });
      }

      var goZoneStyle = {
        // fillColor: 'rgba(49, 177, 77, 1)',
        color: "rgba(49, 177, 77, 1)",
        weight: 5,
      };

      var goZoneLayer = L.geoJSON(
        { features: [GoZones] },
        {
          style: goZoneStyle,
        }
      ).addTo(mymap);

      var noGoZoneStyle = {
        fillColor: "rgba(231, 24, 24, 0.8)",
        color: "rgba(231, 24, 24, 1)",
        weight: 2,
      };

      var noGoZoneLayer = L.markerClusterGroup();

      var noGoLayer = L.geoJSON(
        { features: [NoGoZones2] },
        {
          style: noGoZoneStyle,
        }
      ).addTo(mymap);

      // var markerLayers = L.markerClusterGroup({});

      // var markerLayer = L.geoJSON(
      //   { features: [markerLabels] },
      //   {
      //     onEachFeature: onEachFeature,
      //     pointToLayer: function (feature, latlng) {
      //       return markerLayers.addLayer(
      //         L.marker(latlng, {
      //           icon:
      //             feature.properties.type === "ev"
      //               ? yellowCircleMarker
      //               : yellowSquareMarker,
      //         })
      //       );
      //     },
      //   }
      // ).addTo(mymap);
      // controlLayers.addOverlay(markerLayer, "Markers");

      var plannedWaypointLineStyle = {
        color: "#A7A7A7",
        // dashArray: 4,
        weight: 6,
      };

      var plannedWaypoints = L.geoJSON(
        { features: [plannedWaypoints] },
        {
          style: plannedWaypointLineStyle,
        }
      ).addTo(mymap);

      var actualWaypointLineStyle = {
        color: "white",
        dashArray: 4,
        weight: 2,
      };

      var actualWaypoints = L.geoJSON(
        { features: [actualWaypoints] },
        {
          style: actualWaypointLineStyle,
        }
      ).addTo(mymap);

      function handleEVMarkerMove(e) {
        markerPulse.slideTo(e.latlng, {
          duration: 3000,
          keepAtCenter: false,
        });
      }

      // function onMapClick(e) {
      //   console.log(e.latlng.toString());
      // }

      // mymap.on("click", onMapClick);

      L.control
        .scale({
          metric: true,
          imperial: true,
          position: "topright",
        })
        .addTo(mymap);

      var baseMaps = {
        "Label Map": marsLabeledMapLayer,
        "Shaded Map": marsShaded,
        "Color Coded MOLA Elevation Map": marsMOLA,
        "Viking Map": marsVikingLayer,
        "Greyscale Map": marsGrayscale,
        "Hillshade Map": marsHillshade,
      };

      var overlayMaps = {
        "Go Zones": goZoneLayer,
        "No Go Zones": noGoLayer,
        // Markers: markerLayers,
        "Actual Waypoints": actualWaypoints,
        "Planned Waypoints": plannedWaypoints,
      };

      L.control.layers(baseMaps, overlayMaps).addTo(mymap);

      mymap.pm.setGlobalOptions({
        enableDraw: {
          markerStyle: {
            icon: yellowSquareMarker,
          },
        },
      });

      mymap.on("pm:create", (e) => {
        e.marker
          .bindPopup(
            "<p>[" +
              e.marker._latlng.lng.toPrecision(7) +
              ", " +
              e.marker._latlng.lat.toPrecision(7) +
              "]: </p>",
            { removable: true, editable: true }
          )
          .openPopup();
      });

      window.addEventListener("beforeunload", function (ev) {
        return (ev.returnValue = "Are you sure you want to refresh this page?");
      });

      var ZoomViewer = L.Control.extend({
        onAdd: function () {
          var container = L.DomUtil.create("div");
          var gauge = L.DomUtil.create("div");
          container.style.width = "200px";
          container.style.background = "rgba(255,255,255,0.5)";
          container.style.textAlign = "left";
          mymap.on("zoomstart zoom zoomend", function (ev) {
            gauge.innerHTML = "Zoom level: " + mymap.getZoom();
          });
          container.appendChild(gauge);

          return container;
        },
      });

      new ZoomViewer().addTo(mymap);

      mymap.pm.setGlobalOptions({
        measurements: { measurement: true, displayFormat: "metric" },
      });

      // Geoman Event Handling
      // listen to vertexes being added to currently drawn layer (called workingLayer)
      // mymap.on("pm:drawstart", ({ workingLayer }) => {
      // workingLayer.on("pm:snap", (e) => {
      // console.log(e);
      // if (e.shape === "Marker") {
      // e.marker.bindPopup('<p>Hello world!<br />This is a nice popup.</p>').openPopup();

      // e.marker.bindPopup('<p>Hello world!<br />This is a nice popup.</p>', { removable: true, editable: true });

      // var popup = L.popup()
      // .setLatLng([ e.snapLatLng.lat,e.snapLatLng.lng])
      // .setContent('<p>Hello world!<br />This is a nice popup.</p>')
      // .openOn(mymap);

      // let feature = {
      //   id: (Math.random() * Math.floor(99999999)).toString(),
      //   properties: { type: "taggedLocation" },
      //   type: "Feature",
      //   geometry: {
      //     type: "Point",
      //     coordinates: [e.snapLatLng.lat,e.snapLatLng.lng],
      //   },
      // };

      // var popupContent = "<p>[" + feature.geometry.coordinates + "]:</p>";

      // if (feature.properties && feature.properties.popupContent) {
      //   popupContent += feature.properties.popupContent;
      // }

      // e.layer.bindPopup(popupContent, {
      //   removable: true,
      //   editable: true,
      // });
      //     }
      //   });
      // });
    </script>
  </body>
</html>
